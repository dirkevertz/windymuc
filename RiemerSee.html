<!DOCTYPE html>
<html>

<head>
  <title>Webcam Bilder</title>
  <style>
    .container {
      display: flex;
      position: relative;
    }

    .image {
      width: 50%;
    }

    .timestamp {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 5px;
      font-family: monospace;
      z-index: 1;
      /* Stellt sicher, dass der Zeitstempel über den Bildern angezeigt wird */
    }
  </style>
</head>

<body>

  <div class="container">
    <img class="image" id="imageLeft" src="" alt="Bild links">
    <img class="image" id="imageRight" src="" alt="Bild rechts">
    <div class="timestamp" id="timestamp"></div>
  </div>

  <script>
    function updateImages() {
      // Aktuelles Datum und Zeit abrufen
      let now = new Date();

      // Minuten auf den nächsten 10-Minuten-Takt abrunden
      let minutes = Math.floor(now.getMinutes() / 10) * 10;
      now.setMinutes(minutes, 0, 0);

      // Funktion zum Erstellen der Bild-URL
      function createImageUrl(date, time, cam) {
        let dateString = date.getFullYear() + '/' + ('0' + (date.getMonth() + 1)).slice(-2) + '/' + ('0' + date.getDate()).slice(-2);
        let timeString = ('0' + time.getHours()).slice(-2) + '-' + ('0' + time.getMinutes()).slice(-2) + '-00';
        return 'https://panodata9.panomax.com/cams/2027/' + dateString + '/' + timeString + '_h2800_' + cam + '_0.jpg';
      }

      // URLs der Bilder erstellen (Korrektur: now als date, now mit korrigierten Minuten als time)
      let urlLeft = createImageUrl(now, now, 9);
      let urlRight = createImageUrl(now, now, 10);

      // Bilder laden und auf Fehler prüfen
      loadImages(urlLeft, urlRight, now, minutes);
    }

    function loadImages(urlLeft, urlRight, now, minutes) {
      let imgLeft = new Image();
      let imgRight = new Image();

      imgLeft.onload = function () {
        document.getElementById('imageLeft').src = urlLeft; // Bild direkt anzeigen
      };

      imgLeft.onerror = function () {
        console.log('Fehler beim Laden des linken Bildes. Versuche es mit dem Bild von vor 10 Minuten.');
        let previousTimestamp = getPreviousTimestamp(now); // Berechne den vorherigen Zeitstempel
        let newUrlLeft = createImageUrl(previousTimestamp, previousTimestamp, 9);
        imgLeft.src = newUrlLeft; // Bild mit neuer URL laden
      };

      imgRight.onload = function () {
        document.getElementById('imageRight').src = urlRight; // Bild direkt anzeigen
      };

      imgRight.onerror = function () {
        console.log('Fehler beim Laden des rechten Bildes. Versuche es mit dem Bild von vor 10 Minuten.');
        let previousTimestamp = getPreviousTimestamp(now); // Berechne den vorherigen Zeitstempel
        let newUrlRight = createImageUrl(previousTimestamp, previousTimestamp, 10);
        imgRight.src = newUrlRight; // Bild mit neuer URL laden
      };

      imgLeft.src = urlLeft;
      imgRight.src = urlRight;

      // Zeitstempel aktualisieren
      let dateString = now.getFullYear() + '/' + ('0' + (now.getMonth() + 1)).slice(-2) + '/' + ('0' + now.getDate()).slice(-2);
      let timeString = ('0' + now.getHours()).slice(-2) + '-' + ('0' + minutes).slice(-2) + '-00';
      document.getElementById('timestamp').textContent = dateString + ' ' + timeString;
    }

    // Funktion zur Berechnung des vorherigen Zeitstempels
    function getPreviousTimestamp(date) {
      let newDate = new Date(date.getTime()); // Kopie des Datum-Objekts erstellen
      let minutes = newDate.getMinutes();
      minutes = Math.floor(minutes / 10) * 10 - 10; // In 10er-Schritten abrunden und 10 Minuten abziehen
      newDate.setMinutes(minutes, 0, 0); // Minuten, Sekunden und Millisekunden zurücksetzen
      return newDate;
    }

    // Bilder beim Laden der Seite aktualisieren
    updateImages();

    // Bilder alle 1 Minute aktualisieren
    setInterval(updateImages, 60000); // Aktualisierungsintervall auf 1 Minute geändert
  </script>

</body>

</html>