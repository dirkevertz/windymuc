<!DOCTYPE html>
<html>
  <head>
    <title>v2</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        margin: 0;
        /* Entferne Standard-Margins */
      }

      .chart-container {
        position: fixed;
        bottom: 0; /* Chart am unteren Rand andocken */
        left: 0;
        width: 100%;
        height: 40%; /* Chart nimmt 1/3 der Bildhöhe ein */
        z-index: 9;
        /* Hintergrund transparent machen */
        background-color: rgba(255, 255, 255, 0.8);
        display: flex;
        justify-content: center;
      }
    </style>
  </head>

  <body>
    <div>
      <canvas id="myChart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const chartContainer = document.getElementById("myChart");

        fetch(
          "https://windyapp.co/apiV9.php?method=getMeteostationDataAndInfo&meteostationID=DWD_3379"
        )
          .then((response) => response.json())
          .then((data) => {
            const windAvg = data.response.data.map((item) => ({
              x: new Date(item.timestamp * 1000).toLocaleString(),
              y: item.wind_avg * 3.6, // m/s in km/h umrechnen
            }));
            /*
        const windMin = data.response.data.map(item => ({
            x: new Date(item.timestamp * 1000).toLocaleString(), 
            y: item.wind_min * 3.6 // m/s in km/h umrechnen
        }));*/
            const windMax = data.response.data.map((item) => ({
              x: new Date(item.timestamp * 1000).toLocaleString(),
              y: item.wind_max * 3.6, // m/s in km/h umrechnen
            }));

            const myChart = new Chart(chartContainer, {
              type: "line",
              data: {
                datasets: [
                  {
                    label: "Wind Durchschnitt",
                    data: windAvg,
                    borderColor: "blue",
                    fill: false,
                  },
                  /*
              {
                label: 'Wind Minimum',
                data: windMin,
                borderColor: 'green',
                fill: false
              },*/
                  {
                    label: "Wind Maximum",
                    data: windMax,
                    borderColor: "red",
                    fill: false,
                  },
                ],
              },
              options: {
                events: ['mousemove', 'mouseout', 'click', 'touchstart', 'touchmove'],
                plugins: {
                  tooltip: {
                    // Tooltip will only receive click events
                    events: ['click']
                  }
                },
                width: window.innerWidth,
                maintainAspectRatio: false,
                responsive: true,
                scales: {
                  x: {
                    type: "category",
                  },
                  y: {
                    title: {
                      display: true,
                      text: "Windgeschwindigkeit (km/h)", // Achsenbeschriftung anpassen
                    },
                  },
                },
              },
            });

            // Onclick-Event für das Diagramm innerhalb des Event-Listeners
            myChart.canvas.onclick = function(evt) {
              const activePoints = myChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, false);
              if (activePoints.length) {
                const firstPoint = activePoints[0];
                const label = myChart.data.labels[firstPoint.index];
                const value = myChart.data.datasets[firstPoint.datasetIndex].data[firstPoint.index];
                alert(`Label: ${label}, Wert: ${value}`);
              }
            };
          });
      });
    </script>
  </body>
</html>